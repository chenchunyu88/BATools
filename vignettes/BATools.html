<p>The package <code>BATools</code> is used to perform genome-wide association using a various Bayesian models. It is a implemented using both MCMC and EM algorithm.</p>
<p>The basic functions in <code>BATools</code> is <code>bafit</code>, which fits a genomic selection model using different prior selection. The main characteristic of this package are:</p>
<ul>
<li>Fit model with different prior specification including the Antedependence model</li>
<li>Flexibility to choose between MCMC and EM algorithm, both of which are able to estimate the hyperparameters</li>
<li>Accepts <code>gpData</code> objects from package <code>synbreed</code> as input data. It can also use <code>numeric</code> and <code>matrix</code> as input</li>
<li>It is computationally efficient</li>
<li>GWA using EM BayesA/C (under development)</li>
</ul>
<h2 id="introduction">1. Introduction</h2>
<p>Whole genome prediction (WGP) is an evolutionary development in animal breeding. Currently, many models have been developed for WGP, which included rrBLUP, BayesA, BayesB, BayesC, Bayesian Lasso, Antedepedence BayesA/B (Meuwissen et al. 2001, VanRaden 2008, de los Campos et al. 2009, Habier et al. 2011, and Yang and Tempelman 2012). The major difference of these models are different prior assumptions on marker effects. Software packages like <code>BGLR</code> and <code>GenSel</code> implement BayesA, BayesB and Bayes Lasso model using MCMC algorithm. No public software is available to implement Antedependence models. At the same time, no R package is available for implement BayesA/C using EM algorithm for animal breeding. <code>BATools</code> package provides tools to fit Antedependence models in addition to some of the most popular models and provider faster EM algorithms to fit the model. The table below is a comparison between <code>BATools</code> and <code>BGLR</code>:</p>
<table>
<thead>
<tr class="header">
<th align="left">Model/Algorithms</th>
<th align="left">MCMC</th>
<th align="left">EM</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">rrBLUP</td>
<td align="left">BATools/BGLR</td>
<td align="left">BATools</td>
</tr>
<tr class="even">
<td align="left">BayesA</td>
<td align="left">BATools/BGLR</td>
<td align="left">BATools</td>
</tr>
<tr class="odd">
<td align="left">BayesB</td>
<td align="left">BATools/BGLR</td>
<td align="left">under development</td>
</tr>
<tr class="even">
<td align="left">BayesC</td>
<td align="left">BATools/BGLR</td>
<td align="left">BATools</td>
</tr>
<tr class="odd">
<td align="left">Bayesian Lasso</td>
<td align="left">BATools/BGLR</td>
<td align="left">under development</td>
</tr>
<tr class="even">
<td align="left">AnteBayesA</td>
<td align="left">BATools</td>
<td align="left">under development</td>
</tr>
<tr class="odd">
<td align="left">AnteBayesB</td>
<td align="left">BATools</td>
<td align="left">under development</td>
</tr>
</tbody>
</table>
<h2 id="basic-model">2. Basic Model</h2>
<p>The basic model used by <code>BATools</code> is: <br /><span class="math display"><strong>y</strong> = <strong>X</strong> ⋅ <strong>b</strong> + <strong>Z</strong> ⋅ <strong>g</strong> + <strong>e</strong>, </span><br /> where:</p>
<ul>
<li><span class="math inline"><strong>y</strong></span> is the vector of response variables</li>
<li><span class="math inline"><strong>X</strong> ⋅ <strong>b</strong></span> models the fixed effects</li>
<li><span class="math inline"><strong>g</strong></span> is the SNP marker effect and <span class="math inline"><strong>Z</strong></span> is corresponding genotype matrix of <span class="math inline"><em>n</em> ⋅ <em>m</em></span></li>
<li><span class="math inline"><strong>e</strong></span> are the vector of effects residual, <span class="math inline"><strong>e</strong> ∼ <em>N</em>(<strong>0</strong>, <strong>I</strong><em>σ</em><sub><em>e</em></sub><sup>2</sup>)</span></li>
</ul>
<p>Notice that for different models, the priors on <span class="math inline"><strong>g</strong><sub><em>i</em></sub></span> are different: - rrBLUP: <span class="math inline"><strong>g</strong><sub><em>j</em></sub> ∼ <em>N</em>(<strong>0</strong>, <strong>I</strong><em>σ</em><sub><em>g</em></sub><sup>2</sup>)</span> - BayesA: <span class="math inline"><strong>g</strong><sub><em>j</em></sub> ∼ <em>N</em>(<strong>0</strong>, <strong>D</strong><em>σ</em><sub><em>g</em></sub><sup>2</sup>)</span>, where <span class="math inline"><strong>D</strong> = {<em>τ</em><sub>1</sub>, <em>τ</em><sub>2</sub>, ..., <em>τ</em><sub><em>m</em></sub>}</span> and <span class="math inline"><em>τ</em><sub><em>j</em></sub> ∼ <em>χ</em><sup> − 2</sup>(<em>ν</em><sub><em>g</em></sub>, <em>ν</em><sub><em>g</em></sub>)</span></p>
<ul>
<li><p>BayesB: <span class="math inline"><strong>g</strong><sub><em>j</em></sub> ∼ <em>N</em>(<strong>0</strong>, <strong>D</strong><em>σ</em><sub><em>g</em></sub><sup>2</sup>)</span>, where <span class="math inline"><strong>D</strong> = {<em>τ</em><sub>1</sub>, <em>τ</em><sub>2</sub>, ..., <em>τ</em><sub><em>m</em></sub>}</span> and <br /><span class="math display">$$\tau_j=\{\begin{array}
{rrr}
0  &amp; \mbox{with probability} &amp; \pi \\
{\sim \chi^{-2}\left( \nu_g,\nu_g \right)} &amp; \mbox{with probability} &amp; 1-\pi
\end{array}$$</span><br /></p></li>
<li>BayesC: <span class="math inline"><strong>g</strong><sub><em>i</em></sub> ∼ <em>N</em>(<strong>0</strong>, <strong>D</strong><em>σ</em><sub><em>g</em></sub><sup>2</sup>)</span>, where <span class="math inline">$\boldsymbol{D}=\{ \tau_1+\frac{1-\tau_1}{c},\tau_2+\frac{1-\tau_2}{c}, ...,\tau_m+\frac{1-\tau_m}{c}\}$</span> and <span class="math inline"><em>τ</em><sub><em>j</em></sub> ∼ <em>B</em><em>e</em><em>r</em><em>n</em><em>o</em><em>u</em><em>l</em><em>l</em><em>i</em>(<em>π</em>)</span>, <span class="math inline"><em>τ</em><sub><em>j</em></sub> = 0, 1</span></li>
<li><p>Bayesian Lasso: <span class="math inline"><strong>g</strong><sub><em>j</em></sub> ∼ <em>N</em>(<strong>0</strong>, <strong>D</strong><em>σ</em><sub><em>g</em></sub><sup>2</sup>)</span>, where <span class="math inline"><strong>D</strong> = {<em>τ</em><sub>1</sub>, <em>τ</em><sub>2</sub>, ..., <em>τ</em><sub><em>m</em></sub>}</span> and <span class="math inline"><em>τ</em><sub><em>j</em></sub> ∼ <em>E</em><em>x</em><em>p</em>(<em>λ</em><sup>2</sup>)</span></p></li>
</ul>
<p>Furthermore, the Antedepedence models specify correlation structure for <span class="math inline"><strong>g</strong></span> based on the relative physical location of SNP markers along the chromosome : <br /><span class="math display">$$g_j=\{\begin{array}
{rrr}
\delta_j  &amp; \mbox{if} &amp; j=1 \\
t_{j,j-1}\delta_{j-1}+\delta_j &amp; \mbox{if} &amp; 2\leq j \leq m
\end{array}$$</span><br /></p>
<h2 id="batools-example">3. BATools example</h2>
<p>In <code>BATools</code>, we adhered the data structure of the object <code>gpData</code> in the <code>synbreed</code> package. The input and output objects are named as <code>baData</code> and <code>BAout</code>, which are R object class <code>list</code>. Therefore, users can directly use <code>synbreed</code> object as the input for <code>BATools</code>, and vice versa. More detailed explanation about <code>baData</code> and <code>BAout</code> can be found in the package manual file.</p>
<h2 id="example">Example</h2>
<p>We will use a toy dataset from the MSUPRP population to illustrate the use of <code>BATools</code></p>
<h3 id="load-packages-and-data">Load packages and data</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(BATools)</code></pre></div>
<pre><code>## Loading required package: msm
## Loading required package: synbreed
## Loading required package: doBy
## Loading required package: survival
## Loading required package: BLR
## Loading required package: SuppDists
## Package &#39;BLR&#39;, 1.4 (2014-12-03). 
## Type &#39;help(BLR)&#39; for summary information
## Loading required package: regress
## Loading required package: abind
## Loading required package: coda
## Package &#39;BATools&#39;, 0.0.3 (2014-04-24), build 1. 
## Type &#39;help(BATools)&#39; for summary information</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(<span class="st">&quot;MSUPRP_sample&quot;</span>)
<span class="kw">summary</span>(MSUPRP_sample)</code></pre></div>
<pre><code>## object of class &#39;gpData&#39; 
## covar 
##   No. of individuals 253 
##           phenotyped 176 
##            genotyped 251 
## pheno 
##   No. of traits:        3 
## 
##      ph_24h         temp_24h        driploss    
##  Min.   :5.190   Min.   :1.100   Min.   :0.000  
##  1st Qu.:5.450   1st Qu.:1.600   1st Qu.:0.560  
##  Median :5.540   Median :1.900   Median :0.940  
##  Mean   :5.552   Mean   :1.983   Mean   :1.141  
##  3rd Qu.:5.640   3rd Qu.:2.300   3rd Qu.:1.545  
##  Max.   :6.350   Max.   :3.400   Max.   :4.330  
##  NA&#39;s   :35      NA&#39;s   :18      NA&#39;s   :18     
## 
## geno 
##   No. of markers 20597 
##   genotypes 0 1 2 
##   frequencies 0.287 0.404 0.308 
##   NA&#39;s 0.000 %
## map 
##   No. of mapped markers  20597 
##   No. of chromosomes     18 
## 
##   markers per chromosome 
##  
##    1    2    3    4    5    6    7    8    9   10   11   12   13   14   15 
## 1968 1419 1261 1559 1076 1143 1289  939 1426  958  936  833 1319 1263 1079 
##   16   17   18 
##  972  739  418 
## 
## pedigree 
## Number of 
##   individuals  253 
##   males :  98 , females :  155 
##   Par 1 (sire)  10 
##   Par 2 (dam)   44 
##   generations  3</code></pre>
<p>Then we can create the data object used in <code>BATools</code> by <code>create.baData</code>. In this example we treat the sex as fixed effects</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pheno&lt;-<span class="kw">data.frame</span>(MSUPRP_sample$pheno[,,]) 
geno&lt;-MSUPRP_sample$geno[,<span class="dv">1</span>:<span class="dv">500</span>]
ped&lt;-MSUPRP_sample$pedigree
map=MSUPRP_sample$map
sex&lt;-ped$sex
sex&lt;-<span class="kw">as.factor</span>(sex)
x&lt;-<span class="kw">model.matrix</span>( ~<span class="st"> </span>sex -<span class="dv">1</span>,<span class="dt">contrasts.arg=</span><span class="kw">list</span>(<span class="dt">sex=</span><span class="kw">contrasts</span>(sex, <span class="dt">contrasts=</span>F)))
<span class="kw">colnames</span>(x)&lt;-<span class="kw">c</span>(<span class="st">&quot;female&quot;</span>,<span class="st">&quot;male&quot;</span>)
<span class="kw">rownames</span>(x)&lt;-ped$ID
pig=<span class="kw">create.baData</span>(<span class="dt">pheno=</span>pheno,<span class="dt">geno=</span>geno,<span class="dt">map=</span>map,<span class="dt">pedigree=</span>ped,<span class="dt">fixed=</span>x,<span class="dt">makeAinv=</span>F)</code></pre></div>
<h3 id="set-up-initial-values-for-the-model">Set up initial values for the model</h3>
<p>We choose to demonstrate how to fit BayesA using MCMC and EM. We start with MCMC:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">init=<span class="kw">list</span>(<span class="dt">df=</span><span class="dv">5</span>,<span class="dt">scale=</span><span class="fl">0.01</span>,<span class="dt">pi=</span><span class="dv">1</span>)
run_para=<span class="kw">list</span>(<span class="dt">niter=</span><span class="dv">50000</span>,<span class="dt">burnIn=</span><span class="dv">25000</span>,<span class="dt">skip=</span><span class="dv">10</span>)
print_mcmc=<span class="kw">list</span>(<span class="dt">piter=</span><span class="dv">5000</span>)
update_para=<span class="kw">list</span>(<span class="dt">df=</span><span class="ot">FALSE</span>,<span class="dt">scale=</span><span class="ot">TRUE</span>,<span class="dt">pi=</span><span class="ot">FALSE</span>)
op&lt;-<span class="kw">create.options</span>(<span class="dt">model=</span><span class="st">&quot;BayesA&quot;</span>,<span class="dt">method=</span><span class="st">&quot;MCMC&quot;</span>,<span class="dt">ante=</span><span class="ot">FALSE</span>,<span class="dt">priors=</span><span class="ot">NULL</span>,<span class="dt">init=</span>init,
  <span class="dt">update_para=</span>update_para,<span class="dt">run_para=</span>run_para,<span class="dt">save.at=</span><span class="st">&quot;BayesA&quot;</span>,<span class="dt">cv=</span><span class="ot">NULL</span>,<span class="dt">print_mcmc=</span>print_mcmc)</code></pre></div>
<h3 id="fit-the-model">Fit the model</h3>
<p>We then fit the model using MCMC for the trait <code>driploss</code> with the above setups:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ba&lt;-<span class="kw">bafit</span>(<span class="dt">dataobj=</span>pig,<span class="dt">op=</span>op,<span class="dt">trait=</span><span class="st">&quot;driploss&quot;</span>)</code></pre></div>
<pre><code>## iter=  5000  vare=  0.398566 scale=  0.00105204 timepercycle=  0 estimated time left= 17.05 
## iter=  10000  vare=  0.463867 scale=  0.0003276 timepercycle=  0 estimated time left= 15.4 
## iter=  15000  vare=  0.385029 scale=  0.00031513 timepercycle=  0 estimated time left= 13.66 
## iter=  20000  vare=  0.522063 scale=  0.00038917 timepercycle=  0 estimated time left= 11.77 
## iter=  25000  vare=  0.475752 scale=  0.00023557 timepercycle=  0 estimated time left= 9.81 
## iter=  30000  vare=  0.41755 scale=  0.00031678 timepercycle=  0 estimated time left= 7.94 
## iter=  35000  vare=  0.437284 scale=  0.00058263 timepercycle=  0 estimated time left= 6.01 
## iter=  40000  vare=  0.544676 scale=  0.00072504 timepercycle=  0 estimated time left= 4.03 
## iter=  45000  vare=  0.472078 scale=  0.00100352 timepercycle=  0 estimated time left= 2.03 
## iter=  50000  vare=  0.512905 scale=  0.00051462 timepercycle=  0 estimated time left= 0</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ba</code></pre></div>
<pre><code>## BATools analysis of trait: driploss 
## 
## estimated fixed effects:
##   female     male 
## 1.167856 1.062502 
## 
## estimated hyperparameters:
##         vare         varg 
## 0.5218771950 0.0004800222 
## 
## effective sample size for hyperparameters: 
##      vare      varg 
## 1812.3013   95.7466</code></pre>
<h3 id="graphics">Graphics</h3>
<p>We can obtain the traceplot for MCMC:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">par</span>(<span class="dt">mar=</span><span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>))
<span class="kw">baplot</span>(<span class="dt">dataobj=</span>pig,<span class="dt">BAout=</span>ba,<span class="dt">type=</span><span class="st">&quot;trace&quot;</span>,<span class="dt">op=</span>op)</code></pre></div>
<div class="figure">
<img src="figure/unnamed-chunk-5-1.png" alt="Traceplot" />
<p class="caption">Traceplot</p>
</div>
<h3 id="em-algorithm">EM algorithm</h3>
<p>To use the EM algorithm in <code>BATools</code>, we first run an analysis using rrBLUP:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">##################run rrBLUP REML#####################
init=<span class="kw">list</span>(<span class="dt">df=</span><span class="ot">NULL</span>,<span class="dt">scale=</span><span class="ot">NULL</span>,<span class="dt">vare=</span><span class="ot">NULL</span>)
run_para=<span class="kw">list</span>(<span class="dt">maxiter=</span><span class="dv">100</span>)
update_para=<span class="kw">list</span>(<span class="dt">df=</span><span class="ot">FALSE</span>,<span class="dt">scale=</span><span class="ot">TRUE</span>)
op&lt;-<span class="kw">create.options</span>(<span class="dt">model=</span><span class="st">&quot;rrBLUP&quot;</span>,<span class="dt">method=</span><span class="st">&quot;EM&quot;</span>,<span class="dt">ante=</span><span class="ot">FALSE</span>,<span class="dt">priors=</span><span class="ot">NULL</span>,<span class="dt">init=</span>init,
    <span class="dt">update_para=</span>update_para,<span class="dt">run_para=</span>run_para,<span class="dt">save.at=</span><span class="st">&quot;rrBLUP&quot;</span>,<span class="dt">cv=</span><span class="ot">NULL</span>,<span class="dt">print_mcmc=</span><span class="ot">NULL</span>,<span class="dt">convcrit=</span><span class="fl">1E-4</span>)

rr&lt;-<span class="kw">bafit</span>(<span class="dt">dataobj=</span>pig,<span class="dt">op=</span>op,<span class="dt">trait=</span><span class="st">&quot;driploss&quot;</span>)</code></pre></div>
<pre><code>## rrBLUP iter= 1 
## Residual Variance is 0.4839849 Genetic Variance is 0.001855619
## rrBLUP iter= 2 
## Residual Variance is 0.4699503 Genetic Variance is 0.0009278096
## rrBLUP iter= 3 
## Residual Variance is 0.4511434 Genetic Variance is 0.000413168
## rrBLUP iter= 4 
## Residual Variance is 0.4477918 Genetic Variance is 0.000596557
## rrBLUP iter= 5 
## Residual Variance is 0.4484596 Genetic Variance is 0.0006125085
## rrBLUP iter= 6 
## Residual Variance is 0.4485716 Genetic Variance is 0.0006098466
## rrBLUP iter= 7 
## Residual Variance is 0.4485506 Genetic Variance is 0.0006103478
## rrBLUP iter= 8 
## Residual Variance is 0.4485546 Genetic Variance is 0.0006102548
## rrBLUP iter= 9 
## Residual Variance is 0.4485538 Genetic Variance is 0.0006102721
## rrBLUP iter= 10 
## Residual Variance is 0.448554 Genetic Variance is 0.0006102689
## 
## rrBLUP converged after 10 iterations and the convergence critira is 3.041205e-07</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">rr</code></pre></div>
<pre><code>## BATools analysis of trait: driploss 
## 
## estimated fixed effects:
##   female     male 
## 1.147724 1.075463 
## 
## estimated hyperparameters:
##         vare         varg 
## 0.4485539606 0.0006102689</code></pre>
<p>Then we use rrBLUP results as starting values for EM BayesA:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df_i=<span class="dv">5</span>
scale_i=(df_i<span class="dv">-2</span>)/df_i*rr$hyper_est[<span class="dv">2</span>]
init=<span class="kw">list</span>(<span class="dt">df=</span>df_i,<span class="dt">scale=</span>scale_i,<span class="dt">vare=</span>rr$hyper_est[<span class="dv">1</span>],<span class="dt">g=</span>rr$ghat,<span class="dt">b=</span>rr$betahat,<span class="dt">pi=</span><span class="dv">1</span>)
run_para=<span class="kw">list</span>(<span class="dt">maxiter=</span><span class="dv">100</span>)
update_para=<span class="kw">list</span>(<span class="dt">df=</span><span class="ot">FALSE</span>,<span class="dt">scale=</span><span class="ot">TRUE</span>,<span class="dt">pi=</span><span class="ot">FALSE</span>)
op&lt;-<span class="kw">create.options</span>(<span class="dt">model=</span><span class="st">&quot;BayesA&quot;</span>,<span class="dt">method=</span><span class="st">&quot;EM&quot;</span>,<span class="dt">ante=</span><span class="ot">FALSE</span>,<span class="dt">priors=</span><span class="ot">NULL</span>,<span class="dt">init=</span>init,<span class="dt">D=</span><span class="st">&quot;V&quot;</span>,
    <span class="dt">update_para=</span>update_para,<span class="dt">run_para=</span>run_para,<span class="dt">save.at=</span><span class="st">&quot;BayesA&quot;</span>,<span class="dt">cv=</span><span class="ot">NULL</span>,<span class="dt">print_mcmc=</span><span class="ot">NULL</span>)
ba_em&lt;-<span class="kw">bafit</span>(<span class="dt">dataobj=</span>pig,<span class="dt">op=</span>op,<span class="dt">trait=</span><span class="st">&quot;driploss&quot;</span>)</code></pre></div>
<pre><code>## BayesA EM iter= 1 
## Residual Variance is 0.4464904 Genetic Variance is 0.0006516123
## BayesA EM iter= 2 
## Residual Variance is 0.4477307 Genetic Variance is 0.0007392503
## BayesA EM iter= 3 
## Residual Variance is 0.4478413 Genetic Variance is 0.0007317113
## BayesA EM iter= 4 
## Residual Variance is 0.4475912 Genetic Variance is 0.0007342808
## BayesA EM iter= 5 
## Residual Variance is 0.447605 Genetic Variance is 0.0007339112
## BayesA EM iter= 6 
## Residual Variance is 0.4475951 Genetic Variance is 0.0007340262
## BayesA EM iter= 7 
## Residual Variance is 0.4475959 Genetic Variance is 0.0007340081
## BayesA EM iter= 8 
## Residual Variance is 0.4475955 Genetic Variance is 0.0007340134
## 
## BayesA converged after 8 iterations and the convergence critira is 9.617804e-07</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ba_em</code></pre></div>
<pre><code>## BATools analysis of trait: driploss 
## 
## estimated fixed effects:
##   female     male 
## 1.149234 1.077246 
## 
## estimated hyperparameters:
##         vare         varg 
## 0.4475954851 0.0007340134</code></pre>
<h3 id="graphics-1">Graphics</h3>
<p>Let's look at the estimated phenotypes v.s. true phenotypes for EM:</p>
<p>We can also compare the difference bewteen MCMC and EM:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(ba$ghat,ba_em$ghat,<span class="dt">xlab=</span><span class="st">&quot;MCMC&quot;</span>,<span class="dt">ylab=</span><span class="st">&quot;EM&quot;</span>,<span class="dt">main=</span><span class="st">&quot;BayesA MCMC v.s. EM&quot;</span>)
<span class="kw">abline</span>(<span class="dt">a=</span><span class="dv">0</span>,<span class="dt">b=</span><span class="dv">1</span>)</code></pre></div>
<div class="figure">
<img src="figure/unnamed-chunk-8-1.png" alt="" />

</div>
<h3 id="bayesc">BayesC</h3>
<p>Running BayesC is similar to running BayesA:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">init=<span class="kw">list</span>(<span class="dt">df=</span><span class="dv">5</span>,<span class="dt">scale=</span><span class="fl">0.2</span>,<span class="dt">pi=</span><span class="fl">0.1</span>,<span class="dt">c=</span><span class="dv">1000</span>)
run_para=<span class="kw">list</span>(<span class="dt">niter=</span><span class="dv">2000</span>,<span class="dt">burnIn=</span><span class="dv">1000</span>,<span class="dt">skip=</span><span class="dv">1</span>)
print_mcmc=<span class="kw">list</span>(<span class="dt">piter=</span><span class="dv">200</span>)
update_para=<span class="kw">list</span>(<span class="dt">df=</span>F,<span class="dt">scale=</span>T,<span class="dt">pi=</span>T)
priors=<span class="kw">list</span>(<span class="dt">shape_scale=</span><span class="dv">5</span>,<span class="dt">rate_scale=</span><span class="fl">0.1</span>,<span class="dt">alphapi=</span><span class="dv">1</span>,<span class="dt">betapi=</span><span class="dv">9</span>)
op&lt;-<span class="kw">create.options</span>(<span class="dt">model=</span><span class="st">&quot;BayesC&quot;</span>,<span class="dt">method=</span><span class="st">&quot;MCMC&quot;</span>,
<span class="dt">ante=</span><span class="ot">FALSE</span>,<span class="dt">priors=</span><span class="ot">NULL</span>,<span class="dt">init=</span>init,<span class="dt">update_para=</span>update_para,
<span class="dt">run_para=</span>run_para,<span class="dt">save.at=</span><span class="st">&quot;BayesCC&quot;</span>,<span class="dt">cv=</span><span class="ot">NULL</span>,<span class="dt">print_mcmc=</span>print_mcmc)
bc&lt;-<span class="kw">bafit</span>(<span class="dt">dataobj=</span>pig,<span class="dt">op=</span>op,<span class="dt">trait=</span><span class="st">&quot;driploss&quot;</span>)</code></pre></div>
<pre><code>## iter=  200  vare=  0.486405 scale=  0.10400771 timepercycle=  0 estimated time left= 0.84 
## iter=  400  vare=  0.431683 scale=  0.01256922 timepercycle=  0 estimated time left= 0.73 
## iter=  600  vare=  0.497594 scale=  0.01288561 timepercycle=  0 estimated time left= 0.62 
## iter=  800  vare=  0.441814 scale=  0.01016238 timepercycle=  0 estimated time left= 0.53 
## iter=  1000  vare=  0.471487 scale=  0.00473627 timepercycle=  0 estimated time left= 0.44 
## iter=  1200  vare=  0.503146 scale=  0.00428124 timepercycle=  0 estimated time left= 0.36 
## iter=  1400  vare=  0.559778 scale=  0.00144218 timepercycle=  0 estimated time left= 0.27 
## iter=  1600  vare=  0.365421 scale=  0.00490985 timepercycle=  0 estimated time left= 0.18 
## iter=  1800  vare=  0.402956 scale=  0.00761927 timepercycle=  0 estimated time left= 0.09 
## iter=  2000  vare=  0.480923 scale=  0.00652987 timepercycle=  0 estimated time left= 0</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">bc</code></pre></div>
<pre><code>## BATools analysis of trait: driploss 
## 
## estimated fixed effects:
##    female      male 
## 1.0006318 0.9363722 
## 
## estimated hyperparameters:
##        vare        varg          pi 
## 0.450900299 0.005179001 0.242778069 
## 
## effective sample size for hyperparameters: 
##       vare       varg         pi 
## 211.161947  13.812218   2.458483</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">scale_i=rr$hyper_est[<span class="dv">2</span>]/(<span class="dv">1</span>/<span class="dv">1000</span>*rr$hyper_est[<span class="dv">2</span>]*(<span class="dv">1</span>-bc$hyper_est[<span class="dv">3</span>])+bc$hyper_est[<span class="dv">3</span>]*rr$hyper_est[<span class="dv">2</span>])
init=<span class="kw">list</span>(<span class="dt">df=</span><span class="dv">5</span>,<span class="dt">scale=</span>scale_i,<span class="dt">vare=</span>rr$hyper_est[<span class="dv">1</span>],<span class="dt">g=</span>rr$ghat,<span class="dt">b=</span>rr$betahat,<span class="dt">pi=</span>bc$hyper_est[<span class="dv">3</span>],<span class="dt">c=</span><span class="dv">1000</span>)
run_para=<span class="kw">list</span>(<span class="dt">maxiter=</span><span class="dv">100</span>)
update_para=<span class="kw">list</span>(<span class="dt">df=</span><span class="ot">FALSE</span>,<span class="dt">scale=</span><span class="ot">TRUE</span>,<span class="dt">pi=</span>T)
op&lt;-<span class="kw">create.options</span>(<span class="dt">model=</span><span class="st">&quot;BayesC&quot;</span>,<span class="dt">method=</span><span class="st">&quot;EM&quot;</span>,<span class="dt">ante=</span><span class="ot">FALSE</span>,<span class="dt">priors=</span><span class="ot">NULL</span>,<span class="dt">init=</span>init,
    <span class="dt">update_para=</span>update_para,<span class="dt">run_para=</span>run_para,<span class="dt">save.at=</span><span class="st">&quot;BayesC&quot;</span>,<span class="dt">cv=</span><span class="ot">NULL</span>,<span class="dt">print_mcmc=</span><span class="ot">NULL</span>,<span class="dt">convcrit=</span><span class="fl">1E-4</span>)
bc_em&lt;-<span class="kw">bafit</span>(<span class="dt">dataobj=</span>pig,<span class="dt">op=</span>op,<span class="dt">trait=</span><span class="st">&quot;driploss&quot;</span>)</code></pre></div>
<pre><code>## BayesC EM iter= 1 
## Residual Variance is 0.5189831 Genetic Variance is 2.053091 pi is 0.009901201
## BayesC EM iter= 2 
## Residual Variance is 0.4681158 Genetic Variance is 1.026545 pi is 0.000324081
## BayesC EM iter= 3 
## Residual Variance is 0.4529967 Genetic Variance is 0.305767 pi is 1.039069e-05
## BayesC EM iter= 4 
## Residual Variance is 0.4480365 Genetic Variance is 0.5457502 pi is 3.414867e-07
## BayesC EM iter= 5 
## Residual Variance is 0.4481474 Genetic Variance is 0.6167073 pi is 1.071567e-08
## BayesC EM iter= 6 
## Residual Variance is 0.4486061 Genetic Variance is 0.6090187 pi is 3.381243e-10
## BayesC EM iter= 7 
## Residual Variance is 0.4485441 Genetic Variance is 0.6105003 pi is 1.069146e-11
## BayesC EM iter= 8 
## Residual Variance is 0.4485558 Genetic Variance is 0.6102263 pi is 3.379746e-13
## BayesC EM iter= 9 
## Residual Variance is 0.4485536 Genetic Variance is 0.6102774 pi is 1.068437e-14
## BayesC EM iter= 10 
## Residual Variance is 0.448554 Genetic Variance is 0.6102679 pi is 3.37875e-16
## BayesC EM iter= 11 
## Residual Variance is 0.4485539 Genetic Variance is 0.6102697 pi is 1.04903e-17
## BayesC EM iter= 12 
## Residual Variance is 0.4485539 Genetic Variance is 0.6102693 pi is 4.370957e-19
## 
## BayesC converged after 12 iterations and the convergence critira is 4.35124e-07</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">bc_em</code></pre></div>
<pre><code>## BATools analysis of trait: driploss 
## 
## estimated fixed effects:
##   female     male 
## 1.147724 1.075463 
## 
## estimated hyperparameters:
##         vare         varg           pi 
## 4.485539e-01 6.102693e-01 4.370957e-19</code></pre>
<p>We can also compare the difference bewteen MCMC and EM for BayesC:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(bc$ghat,bc_em$ghat,<span class="dt">xlab=</span><span class="st">&quot;MCMC&quot;</span>,<span class="dt">ylab=</span><span class="st">&quot;EM&quot;</span>,<span class="dt">main=</span><span class="st">&quot;BayesC MCMC v.s. EM&quot;</span>)
<span class="kw">abline</span>(<span class="dt">a=</span><span class="dv">0</span>,<span class="dt">b=</span><span class="dv">1</span>)</code></pre></div>
<div class="figure">
<img src="figure/unnamed-chunk-10-1.png" alt="BayesC" />
<p class="caption">BayesC</p>
</div>
<p>We can also compare the difference bewteen BayesA and BayesC for MCMC:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(ba$ghat,bc$ghat,<span class="dt">xlab=</span><span class="st">&quot;BayesA&quot;</span>,<span class="dt">ylab=</span><span class="st">&quot;BayesC&quot;</span>,<span class="dt">main=</span><span class="st">&quot;BayesA v.s. BayesC in MCMC&quot;</span>)
<span class="kw">abline</span>(<span class="dt">a=</span><span class="dv">0</span>,<span class="dt">b=</span><span class="dv">1</span>)</code></pre></div>
<div class="figure">
<img src="figure/unnamed-chunk-11-1.png" alt="BayesA_C_MCMC" />
<p class="caption">BayesA_C_MCMC</p>
</div>
<p>We can also compare the difference bewteen BayesA and BayesC for EM:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(ba$ghat,bc$ghat,<span class="dt">xlab=</span><span class="st">&quot;BayesA&quot;</span>,<span class="dt">ylab=</span><span class="st">&quot;BayesC&quot;</span>,<span class="dt">main=</span><span class="st">&quot;BayesA v.s. BayesC in EM&quot;</span>)
<span class="kw">abline</span>(<span class="dt">a=</span><span class="dv">0</span>,<span class="dt">b=</span><span class="dv">1</span>)</code></pre></div>
<div class="figure">
<img src="figure/unnamed-chunk-12-1.png" alt="BayesA_C_EM" />
<p class="caption">BayesA_C_EM</p>
</div>
